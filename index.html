<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ATB 101: Your Story, Your Way</title>
  <meta name="description" content="A choose-your-own-adventure built for my ATB application." />

  <style>
    :root{
      --bg: #f6f9ff;
      --card: #ffffff;
      --ink: #0b1b3a;
      --muted: #3d537a;

      /* darker, ATB-ish blues */
      --atb-blue: #003a78;
      --atb-blue-2: #0a57b7;

      --line: #d7e4ff;
      --shadow: 0 10px 30px rgba(0, 25, 80, 0.10);
      --radius: 16px;
    }

    body{
      margin: 0;
      background: radial-gradient(1200px 600px at 20% 0%, #eaf2ff 0%, var(--bg) 60%, #ffffff 100%);
      color: var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .wrap{
      max-width: 820px;
      margin: 0 auto;
      padding: 26px 18px 40px;
    }

    .top{
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .brand{
      display: grid;
      gap: 4px;
    }

    .brand h1{
      font-size: 18px;
      margin: 0;
      letter-spacing: 0.2px;
    }

    .brand .sub{
      font-size: 13px;
      color: var(--muted);
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
      box-shadow: 0 6px 18px rgba(0, 25, 80, 0.06);
      user-select: none;
    }

    .dot{
      width: 9px; height: 9px;
      background: var(--atb-blue);
      border-radius: 999px;
      box-shadow: 0 0 0 4px rgba(0,58,120,0.12);
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
    }

    #text{
      font-size: 18px;
      line-height: 1.55;
      white-space: pre-wrap;
    }

    .score{
      display: grid;
      grid-template-columns: repeat(3, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .kpi{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: linear-gradient(180deg, #ffffff 0%, #f6f9ff 100%);
    }

    .kpi .label{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .kpi .value{
      font-size: 16px;
      font-weight: 650;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .bar{
      height: 8px;
      background: #eaf2ff;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 8px;
      border: 1px solid var(--line);
    }

    .fill{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--atb-blue) 0%, var(--atb-blue-2) 100%);
    }

    .goals{
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: #fff;
    }

    .goals .label{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .goals .value{
      font-size: 14px;
      color: var(--ink);
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
    }

    .choices{
      margin-top: 16px;
      display: grid;
      gap: 10px;
    }

    button.choice{
      border: 1px solid var(--line);
      background: linear-gradient(180deg, #ffffff 0%, #f2f7ff 100%);
      border-radius: 14px;
      padding: 12px 12px;
      cursor: pointer;
      text-align: left;
      font-size: 16px;
      color: var(--ink);
      transition: transform 0.06s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    button.choice:hover{
      border-color: #b8d0ff;
      box-shadow: 0 10px 18px rgba(0, 58, 120, 0.14);
      transform: translateY(-1px);
    }

    button.choice:active{
      transform: translateY(0px);
      box-shadow: 0 6px 12px rgba(0, 58, 120, 0.10);
    }

    .row{
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 14px;
    }

    .pill{
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      color: var(--muted);
      user-select: none;
    }

    .controls{
      margin-left: auto;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button.small{
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 13px;
      color: var(--atb-blue-2);
      cursor: pointer;
    }

    button.small:hover{
      border-color: #b8d0ff;
      box-shadow: 0 8px 14px rgba(0, 58, 120, 0.10);
    }

    .footer{
      margin-top: 14px;
      font-size: 13px;
      color: var(--muted);
    }

    code{ background:#eef4ff; padding:2px 6px; border-radius:8px; border:1px solid var(--line); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>ATB 101: Your Story, Your Way</h1>
        <div class="sub">A short CYOA built from a real week.</div>
      </div>
      <div class="badge"><span class="dot"></span><span id="where">loading…</span></div>
    </div>

    <div class="card">
      <div id="text">Loading story…</div>

      <div class="score" aria-label="Scoreboard">
        <div class="kpi">
          <div class="label">Impact in action</div>
          <div class="value"><span id="vImpact">0</span> / 10</div>
          <div class="bar"><div class="fill" id="bImpact"></div></div>
        </div>
        <div class="kpi">
          <div class="label">Thrive together</div>
          <div class="value"><span id="vThrive">0</span> / 10</div>
          <div class="bar"><div class="fill" id="bThrive"></div></div>
        </div>
        <div class="kpi">
          <div class="label">Ready for tomorrow</div>
          <div class="value"><span id="vReady">0</span> / 10</div>
          <div class="bar"><div class="fill" id="bReady"></div></div>
        </div>
      </div>

      <div class="goals" aria-label="Goals">
        <div class="label">This week’s checklist</div>
        <div class="value">
          <span><span id="gFactum">⬜</span> Factum submitted</span>
          <span><span id="gMLSA">⬜</span> MLSA panel locked</span>
          <span><span id="gWinalta">⬜</span> Winalta/CCAA presentation ready</span>
          <span><span id="gATB">⬜</span> ATB handled (submit or reprieve email)</span>
        </div>
      </div>

      <div class="choices" id="choices"></div>

      <div class="row">
        <div class="pill" id="saveState">Autosave: on</div>
        <div class="controls">
          <button class="small" id="restart">Restart</button>
          <button class="small" id="resetAll">Reset autosave</button>
          <button class="small" id="share">Copy share link</button>
        </div>
      </div>

      <div class="footer">
        Tip: you can link directly to a scene using <code>#nodeId</code>. If you ever see “Missing node”, hit <code>Reset autosave</code>.
      </div>
    </div>
  </div>

  <script>
    /***********************
     *  STORY (single file)
     *  - All node IDs exist
     *  - Text uses real line breaks (no visible \n)
     ***********************/
    const STORY = {
      start: "coldOpen",
      nodes: {
        coldOpen: {
          text: `You open your laptop and pull up the ATB 101 posting.

The deadline line catches your eye: “BY February 12.”

You don’t have time to overthink it. You just note it, because you know how weeks like this go.

You glance at the other open tabs:
- Bowman Tax Moot factum (respondent)
- MLSA speakers panel planning (venue, speakers, food, budget)
- Corporate Reorganization prep: CCAA and Winalta (presentation coming up)

It’s Feb 10, evening.

What do you deal with first?`,
          choices: [
            { label: "Factum first (get something major off the list)", to: "factumTab", delta: { ready: 2 } },
            { label: "MLSA panel first (other people are waiting on you)", to: "mlsaTab", delta: { thrive: 2 } },
            { label: "CCAA/Winalta prep first (presentation is soon)", to: "winaltaTab", delta: { impact: 1, ready: 1 } },
            { label: "Start the ATB application now (before the week gets away from you)", to: "atbTab", delta: { ready: 1 } }
          ]
        },

        /******** FACTUM ********/
        factumTab: {
          text: `You open the factum and scroll to the part you promised you would “just polish.”

It’s always the same trap:
You change one sentence.
Then you reread the paragraph to make sure it still works.
Then you spot something you can tighten.

A couple hours pass.

You check the time.

2:47 AM.

You’re tired enough to know you could keep tweaking forever, and awake enough to be tempted anyway.

What do you do?`,
          choices: [
            { label: "Stop here. Submit the clean version.", to: "factumSubmit", delta: { ready: 2, flags: { factumSent: true } } },
            { label: "Keep going. One more edit.", to: "factumSpiral", delta: { ready: 1 } }
          ]
        },

        factumSpiral: {
          text: `You keep going.

It starts small: a better transition. A cleaner sentence.

Then it’s the chain reaction:
That sentence affects the next one.
That paragraph affects the theme.
That theme affects the introduction.

You look at the filename and realize you’ve created a new taxonomy:
final_v7, realfinal_v8, actuallyfinal_v9.

It’s 3:07 AM now.

You can still land this responsibly, but you have to choose it.

What do you do?`,
          choices: [
            { label: "Submit now. Walk away.", to: "factumSubmit", delta: { ready: 2, flags: { factumSent: true } } },
            { label: "Set a timer and commit to submitting when it ends.", to: "timerTrick", delta: { ready: 2 } }
          ]
        },

        timerTrick: {
          text: `You set a 10-minute timer and do only the most important fixes.

When it goes off, you submit.

It isn’t perfect, but it’s coherent, careful, and it’s done.

That matters.

You close the tab and feel the kind of relief you can only earn.

Next up: the rest of the week didn’t disappear while you were writing.

Where do you go?`,
          choices: [
            { label: "MLSA panel logistics", to: "mlsaTab", delta: { thrive: 1, ready: 1, flags: { factumSent: true } } },
            { label: "CCAA/Winalta prep", to: "winaltaTab", delta: { impact: 1, ready: 1, flags: { factumSent: true } } },
            { label: "ATB application", to: "atbTab", delta: { ready: 2, flags: { factumSent: true } } }
          ]
        },

        factumSubmit: {
          text: `You submit the factum.

It’s a small moment, but it changes the week. One major deadline handled.

You look back at the ATB posting again.

“BY February 12.”

You don’t know yet whether that deadline is about to be your friend or your problem.

What do you tackle next?`,
          choices: [
            { label: "MLSA speakers panel planning", to: "mlsaTab", delta: { thrive: 2, flags: { factumSent: true } } },
            { label: "Corporate Reorg: CCAA/Winalta", to: "winaltaTab", delta: { impact: 1, ready: 1, flags: { factumSent: true } } },
            { label: "ATB application", to: "atbTab", delta: { ready: 2, flags: { factumSent: true } } }
          ]
        },

        /******** MLSA ********/
        mlsaTab: {
          text: `You open the MLSA planning document.

The agenda is taking shape, but three things are still loose:
- a speaker confirmation
- A/V and room logistics
- food that won’t make the budget collapse

The food quotes are higher than you expected.

A teammate messages: “We want it to feel like a real event. But we can’t burn the budget.”

What do you do?`,
          choices: [
            { label: "Negotiate with vendors and try to bring the quote down", to: "foodNegotiation", delta: { thrive: 2, ready: 1 } },
            { label: "Pick a simpler option quickly and keep moving", to: "simpleFood", delta: { thrive: 1, ready: 1 } },
            { label: "Delegate tasks clearly and set deadlines for each piece", to: "delegateMLSA", delta: { thrive: 2 } }
          ]
        },

        foodNegotiation: {
          text: `You write a short, polite email: clarify headcount, ask for options, and propose a number that fits.

You follow up with a call.

It’s not dramatic, but it works. The vendor offers a revised option that gets you under budget.

You update the team and lock in the plan.

MLSA is now on track.

What’s next?`,
          choices: [
            { label: "Finalize speaker confirmations and logistics", to: "mlsaLocked", delta: { thrive: 2, ready: 1, flags: { mlsaLocked: true } } },
            { label: "Switch to CCAA/Winalta prep", to: "winaltaTab", delta: { impact: 1, ready: 1 } },
            { label: "Go to ATB application", to: "atbTab", delta: { ready: 2 } }
          ]
        },

        simpleFood: {
          text: `You choose a simpler option that you know will be reliable and within budget.

It isn’t flashy, but it keeps the event solid.

You update the plan and move to the next item.

What’s next?`,
          choices: [
            { label: "Finalize speaker confirmations and logistics", to: "mlsaLocked", delta: { thrive: 2, flags: { mlsaLocked: true } } },
            { label: "Switch to CCAA/Winalta prep", to: "winaltaTab", delta: { impact: 1, ready: 1 } },
            { label: "Go to ATB application", to: "atbTab", delta: { ready: 2 } }
          ]
        },

        delegateMLSA: {
          text: `You split the work cleanly:
- you handle vendors and budget
- someone handles speaker confirmations
- someone handles room and A/V
- someone handles promotion and the event timeline

You set quick deadlines, and you keep the thread moving.

It’s not “doing everything.” It’s making sure everything gets done.

MLSA is now moving on schedule.

What next?`,
          choices: [
            { label: "Lock it in and close the open items", to: "mlsaLocked", delta: { thrive: 2, ready: 1, flags: { mlsaLocked: true } } },
            { label: "Switch to CCAA/Winalta prep", to: "winaltaTab", delta: { impact: 1, ready: 1 } },
            { label: "Go to ATB application", to: "atbTab", delta: { ready: 2 } }
          ]
        },

        mlsaLocked: {
          text: `The MLSA panel is locked in.

Speakers confirmed. Room booked. Food handled. A/V covered.

That kind of coordination always looks easy after the fact, which is the point.

You check the date.

It’s February 12.

You glance back at the ATB posting again.

“BY February 12.”

What do you do?`,
          choices: [
            { label: "Prepare CCAA/Winalta presentation first, then ATB", to: "winaltaTab", delta: { impact: 1, ready: 1, flags: { mlsaLocked: true } } },
            { label: "Go straight to ATB application", to: "atbTab", delta: { ready: 2, flags: { mlsaLocked: true } } }
          ]
        },

        /******** WINALTA/CCAA ********/
        winaltaTab: {
          text: `You open your Corporate Reorganization notes.

The topic is the CCAA, and the case is Winalta.

The part that stays with you is not the procedural detail. It’s the boundary:
how a court officer stays independent while still being useful, and how things look when that boundary blurs.

You want your presentation to be clear to people who haven’t lived in the case.

How do you build it?`,
          choices: [
            { label: "Tell it as a story: people, incentives, what happened, what the court did", to: "winaltaStory", delta: { impact: 2, ready: 1 } },
            { label: "Structure it: issue → rule → application → takeaway", to: "winaltaIRAC", delta: { ready: 2 } }
          ]
        },

        winaltaStory: {
          text: `You outline the players and the turning point, then land on what the court cared about.

You keep the message simple:
independence matters, and trust is fragile.

The deck feels ready.

What next?`,
          choices: [
            { label: "Mark it ready and go to ATB", to: "atbTab", delta: { ready: 2, flags: { winaltaReady: true } } },
            { label: "Quick rehearsal to tighten the language", to: "winaltaRehearse", delta: { ready: 1 } }
          ]
        },

        winaltaIRAC: {
          text: `You build it so someone can follow it without background.

Issue, rule, application, takeaway.

It’s clean. It’s teachable.

You realize this is one of the things you enjoy most: taking complicated law and making it usable.

What next?`,
          choices: [
            { label: "Mark it ready and go to ATB", to: "atbTab", delta: { ready: 2, flags: { winaltaReady: true } } },
            { label: "Quick rehearsal to tighten the language", to: "winaltaRehearse", delta: { ready: 1 } }
          ]
        },

        winaltaRehearse: {
          text: `You rehearse once.

You simplify one slide that was trying to do too much.

It’s better immediately.

You feel ready for the presentation.

Now there’s one thing left staring at you.

ATB. “BY February 12.”`,
          choices: [
            { label: "Go to ATB application", to: "atbTab", delta: { ready: 2, flags: { winaltaReady: true } } }
          ]
        },

        /******** ATB ********/
        atbTab: {
          text: `You open the application section again: “Tell us your story, your way.”

You’ve tried a few formats in the past:
a short video, a written narrative, even a podcast idea.

They’re fine, but they don’t feel like the best way to show how you actually operate.

What does feel like you is building something practical:
something that lets a reader experience choices and tradeoffs instead of being told about them.

So you build this.

Now the clock is the problem.

It’s February 12.

What do you do?`,
          choices: [
            { label: "Try submitting now and see if the portal still allows it", to: "submitAttempt", delta: { ready: 1 } },
            { label: "Email for a brief reprieve and offer to submit immediately", to: "reprieveEmail", delta: { thrive: 1, ready: 1, flags: { atbHandled: true } } }
          ]
        },

        submitAttempt: {
          text: `You try to submit.

If it goes through, great.
If it doesn’t, you’ll do the only reasonable thing: email, take responsibility, and be practical about next steps.

The page loads.

You wait.

Then you get an error.

Not dramatic. Just final.

What do you do?`,
          choices: [
            { label: "Send the reprieve email (short, accountable, respectful)", to: "reprieveEmail", delta: { thrive: 1, ready: 1, flags: { atbHandled: true } } }
          ]
        },

        reprieveEmail: {
          text: `You write the email.

You keep it simple:
You missed the “BY” deadline.
You’re not asking for special treatment.
You’re asking whether they’ll accept the submission anyway.
You can send it immediately, in whatever format they prefer.

You send it.

It might work, it might not — but it’s honest and it’s professional.

Ending: you handled it directly.`,
          ending: true
        }
      }
    };

    /***********************
     *  ENGINE (single file)
     *  - Uses textContent so no \n appear
     *  - Autosave safe reset
     ***********************/
    const MAX = 10;
    const STORE_KEY = "atb101_cyoa_v3_singlefile";

    let state = {
      impact: 0,
      thrive: 0,
      ready: 0,
      node: null,
      flags: { factumSent: false, mlsaLocked: false, winaltaReady: false, atbHandled: false }
    };

    const elText = document.getElementById("text");
    const elChoices = document.getElementById("choices");
    const elWhere = document.getElementById("where");

    const vImpact = document.getElementById("vImpact");
    const vThrive = document.getElementById("vThrive");
    const vReady = document.getElementById("vReady");

    const bImpact = document.getElementById("bImpact");
    const bThrive = document.getElementById("bThrive");
    const bReady = document.getElementById("bReady");

    const gFactum = document.getElementById("gFactum");
    const gMLSA = document.getElementById("gMLSA");
    const gWinalta = document.getElementById("gWinalta");
    const gATB = document.getElementById("gATB");

    const btnRestart = document.getElementById("restart");
    const btnResetAll = document.getElementById("resetAll");
    const btnShare = document.getElementById("share");

    function clamp(n){ return Math.max(0, Math.min(MAX, n)); }

    function loadSaved(){
      try{
        const raw = localStorage.getItem(STORE_KEY);
        if(!raw) return;
        const parsed = JSON.parse(raw);
        if(parsed && typeof parsed === "object"){
          state = {
            ...state,
            ...parsed,
            flags: { ...state.flags, ...(parsed.flags || {}) }
          };
        }
      }catch(_){}
    }

    function save(){
      try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(_){}
    }

    function setHash(nodeId){
      history.replaceState(null, "", "#" + encodeURIComponent(nodeId));
    }

    function getHash(){
      const h = decodeURIComponent(location.hash.replace("#","")).trim();
      return h || null;
    }

    function updateScoreboard(){
      state.impact = clamp(state.impact);
      state.thrive = clamp(state.thrive);
      state.ready = clamp(state.ready);

      vImpact.textContent = state.impact;
      vThrive.textContent = state.thrive;
      vReady.textContent = state.ready;

      bImpact.style.width = (state.impact / MAX * 100) + "%";
      bThrive.style.width = (state.thrive / MAX * 100) + "%";
      bReady.style.width = (state.ready / MAX * 100) + "%";

      gFactum.textContent = state.flags.factumSent ? "✅" : "⬜";
      gMLSA.textContent = state.flags.mlsaLocked ? "✅" : "⬜";
      gWinalta.textContent = state.flags.winaltaReady ? "✅" : "⬜";
      gATB.textContent = state.flags.atbHandled ? "✅" : "⬜";
    }

    function applyDelta(delta){
      if(!delta) return;
      state.impact += (delta.impact || 0);
      state.thrive += (delta.thrive || 0);
      state.ready += (delta.ready || 0);

      if(delta.flags){
        for(const [k, v] of Object.entries(delta.flags)){
          if(v === true) state.flags[k] = true;
        }
      }

      updateScoreboard();
    }

    function goto(nodeId){
      const node = STORY.nodes[nodeId];
      if(!node){
        elText.textContent = "Missing node: " + nodeId + "\n\nClick “Reset autosave” below.";
        elChoices.innerHTML = "";
        elWhere.textContent = "error";
        return;
      }

      state.node = nodeId;
      setHash(nodeId);
      save();

      elWhere.textContent = "node: " + nodeId;
      elText.textContent = node.text; // key fix: no visible \n, no HTML issues

      elChoices.innerHTML = "";

      if(node.ending){
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.textContent = "Play again (keep score)";
        btn.onclick = () => goto(STORY.start);
        elChoices.appendChild(btn);

        const btn2 = document.createElement("button");
        btn2.className = "choice";
        btn2.textContent = "Restart from zero";
        btn2.onclick = () => {
          state = {
            impact: 0, thrive: 0, ready: 0,
            node: STORY.start,
            flags: { factumSent: false, mlsaLocked: false, winaltaReady: false, atbHandled: false }
          };
          updateScoreboard();
          save();
          goto(STORY.start);
        };
        elChoices.appendChild(btn2);

        return;
      }

      for(const c of (node.choices || [])){
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.textContent = c.label;
        btn.onclick = () => {
          applyDelta(c.delta);
          goto(c.to);
        };
        elChoices.appendChild(btn);
      }
    }

    function resetAutosave(){
      try{ localStorage.removeItem(STORE_KEY); }catch(_){}
      state = {
        impact: 0, thrive: 0, ready: 0,
        node: null,
        flags: { factumSent: false, mlsaLocked: false, winaltaReady: false, atbHandled: false }
      };
      location.hash = "";
      updateScoreboard();
      goto(STORY.start);
    }

    function main(){
      loadSaved();
      updateScoreboard();
      const start = getHash() || state.node || STORY.start;
      goto(start);
    }

    btnRestart.onclick = () => goto(STORY.start);
    btnResetAll.onclick = () => resetAutosave();

    btnShare.onclick = async () => {
      const url = location.href;
      try{
        await navigator.clipboard.writeText(url);
        btnShare.textContent = "Copied";
        setTimeout(() => btnShare.textContent = "Copy share link", 900);
      }catch(_){
        prompt("Copy this link:", url);
      }
    };

    window.addEventListener("hashchange", () => {
      const target = getHash();
      if(target && STORY.nodes[target]) goto(target);
    });

    main();
  </script>
</body>
</html>
